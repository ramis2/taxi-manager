<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taxi Dispatch System</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 10px 10px 0 0;
            text-align: center;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 5px;
        }
        
        .subtitle {
            font-size: 1rem;
            opacity: 0.8;
        }
        
        .tabs {
            display: flex;
            background-color: #34495e;
            border-radius: 0 0 10px 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .tab:hover {
            background-color: #3d566e;
        }
        
        .tab.active {
            background-color: #3498db;
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .dashboard-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .card-title {
            font-size: 1.1rem;
            color: #7f8c8d;
            margin-bottom: 10px;
        }
        
        .card-value {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .card-value.positive {
            color: #27ae60;
        }
        
        .card-value.negative {
            color: #e74c3c;
        }
        
        .section-title {
            color: #2c3e50;
            margin: 25px 0 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }
        
        .dispatch-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        @media (max-width: 992px) {
            .dispatch-container {
                grid-template-columns: 1fr;
            }
        }
        
        .dispatch-form, .active-trips {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            font-size: 15px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn i {
            margin-right: 8px;
        }
        
        .btn-primary {
            background-color: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
        }
        
        .btn-success {
            background-color: #2ecc71;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #27ae60;
        }
        
        .btn-warning {
            background-color: #f39c12;
            color: white;
        }
        
        .btn-warning:hover {
            background-color: #d68910;
        }
        
        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        th, td {
            padding: 14px 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }
        
        tr:hover {
            background-color: #f9f9f9;
        }
        
        .status {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-assigned {
            background-color: #cce5ff;
            color: #004085;
        }
        
        .status-ongoing {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-completed {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .status-cancelled {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        
        .action-btn {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 4px;
            cursor: pointer;
            border: none;
        }
        
        .map-container {
            height: 300px;
            background-color: #e9ecef;
            border-radius: 8px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
            font-weight: 600;
        }
        
        .driver-status {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .driver-available {
            background-color: #2ecc71;
        }
        
        .driver-busy {
            background-color: #e74c3c;
        }
        
        .driver-offline {
            background-color: #95a5a6;
        }
        
        .alert {
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            display: none;
        }
        
        .alert-success {
            background-color: #d5edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .close-modal {
            float: right;
            font-size: 24px;
            cursor: pointer;
            color: #7f8c8d;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-top: 30px;
        }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #e74c3c;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .tab-button {
            position: relative;
        }
        
        .search-container {
            margin-bottom: 20px;
        }
        
        .search-box {
            width: 100%;
            padding: 12px 20px;
            border: 1px solid #ddd;
            border-radius: 25px;
            font-size: 14px;
        }
        
        .filter-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 8px 16px;
            background-color: #ecf0f1;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .filter-btn.active {
            background-color: #3498db;
            color: white;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Taxi Dispatch System</h1>
            <p class="subtitle">Real-time Taxi Dispatching & Trip Management</p>
        </header>
        
        <div class="tabs">
            <div class="tab tab-button active" onclick="switchTab('dashboard')">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </div>
            <div class="tab" onclick="switchTab('dispatch')">
                <i class="fas fa-taxi"></i> Dispatch
                <span class="notification-badge" id="pendingTripsBadge">0</span>
            </div>
            <div class="tab" onclick="switchTab('trips')">
                <i class="fas fa-map-marked-alt"></i> Trips
            </div>
            <div class="tab" onclick="switchTab('drivers')">
                <i class="fas fa-users"></i> Drivers
            </div>
            <div class="tab" onclick="switchTab('reports')">
                <i class="fas fa-chart-bar"></i> Reports
            </div>
        </div>
        
        <!-- Dashboard Tab -->
        <div id="dashboard-tab" class="tab-content active">
            <h2 class="section-title">Dispatch Dashboard</h2>
            
            <div class="dashboard">
                <div class="dashboard-card">
                    <div class="card-title">Available Drivers</div>
                    <div class="card-value" id="availableDrivers">0</div>
                </div>
                <div class="dashboard-card">
                    <div class="card-title">Active Trips</div>
                    <div class="card-value" id="activeTrips">0</div>
                </div>
                <div class="dashboard-card">
                    <div class="card-title">Today's Revenue</div>
                    <div class="card-value positive" id="todayRevenue">$0.00</div>
                </div>
                <div class="dashboard-card">
                    <div class="card-title">Pending Requests</div>
                    <div class="card-value" id="pendingRequests">0</div>
                </div>
            </div>
            
            <div class="dispatch-container">
                <div class="dispatch-form">
                    <h3 class="section-title">Quick Dispatch</h3>
                    <form id="quickDispatchForm">
                        <div class="form-group">
                            <label for="customerName">Customer Name *</label>
                            <input type="text" id="customerName" placeholder="Enter customer name" required>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="customerPhone">Phone Number *</label>
                                <input type="tel" id="customerPhone" placeholder="(555) 123-4567" required>
                            </div>
                            <div class="form-group">
                                <label for="passengers">Passengers</label>
                                <select id="passengers">
                                    <option value="1">1 Passenger</option>
                                    <option value="2">2 Passengers</option>
                                    <option value="3">3 Passengers</option>
                                    <option value="4">4 Passengers</option>
                                    <option value="5">5+ Passengers</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="pickupLocation">Pickup Location *</label>
                            <input type="text" id="pickupLocation" placeholder="Enter pickup address" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="dropoffLocation">Drop-off Location *</label>
                            <input type="text" id="dropoffLocation" placeholder="Enter destination address" required>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="tripType">Trip Type</label>
                                <select id="tripType">
                                    <option value="standard">Standard</option>
                                    <option value="airport">Airport</option>
                                    <option value="city">City Tour</option>
                                    <option value="hourly">Hourly Rental</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="priority">Priority</label>
                                <select id="priority">
                                    <option value="normal">Normal</option>
                                    <option value="high">High</option>
                                    <option value="urgent">Urgent</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="button-group">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-paper-plane"></i> Dispatch Taxi
                            </button>
                            <button type="button" class="btn btn-success" onclick="autoDispatch()">
                                <i class="fas fa-robot"></i> Auto-Dispatch
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="active-trips">
                    <h3 class="section-title">Active Trips</h3>
                    <div class="map-container">
                        <i class="fas fa-map fa-3x"></i>
                        <div style="margin-left: 15px;">Live Dispatch Map</div>
                    </div>
                    
                    <div id="activeTripsList">
                        <!-- Active trips will be dynamically inserted here -->
                        <p style="text-align: center; color: #7f8c8d; padding: 20px;">No active trips at the moment</p>
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 30px;">
                <h3 class="section-title">Recent Trips</h3>
                <table id="recentTripsTable">
                    <thead>
                        <tr>
                            <th>Trip ID</th>
                            <th>Customer</th>
                            <th>Driver</th>
                            <th>Pickup</th>
                            <th>Status</th>
                            <th>Fare</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="recentTripsBody">
                        <!-- Recent trips will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Dispatch Tab -->
        <div id="dispatch-tab" class="tab-content">
            <h2 class="section-title">Trip Dispatch Management</h2>
            
            <div class="alert alert-success" id="dispatchSuccessAlert">
                Trip dispatched successfully!
            </div>
            
            <div class="alert alert-error" id="dispatchErrorAlert">
                Please fill in all required fields.
            </div>
            
            <div class="dispatch-container">
                <div class="dispatch-form">
                    <h3 class="section-title">New Trip Request</h3>
                    <form id="dispatchForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="dispatchCustomerName">Customer Name *</label>
                                <input type="text" id="dispatchCustomerName" placeholder="Enter customer name" required>
                            </div>
                            <div class="form-group">
                                <label for="dispatchCustomerPhone">Phone *</label>
                                <input type="tel" id="dispatchCustomerPhone" placeholder="(555) 123-4567" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="dispatchPickup">Pickup Location *</label>
                            <input type="text" id="dispatchPickup" placeholder="Full address or landmark" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="dispatchDropoff">Destination *</label>
                            <input type="text" id="dispatchDropoff" placeholder="Full address or landmark" required>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="dispatchTime">Preferred Time</label>
                                <input type="datetime-local" id="dispatchTime">
                            </div>
                            <div class="form-group">
                                <label for="dispatchVehicleType">Vehicle Type</label>
                                <select id="dispatchVehicleType">
                                    <option value="any">Any</option>
                                    <option value="sedan">Sedan</option>
                                    <option value="suv">SUV</option>
                                    <option value="van">Van</option>
                                    <option value="luxury">Luxury</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="dispatchFare">Estimated Fare ($)</label>
                                <input type="number" id="dispatchFare" min="0" step="0.01" value="25.00">
                            </div>
                            <div class="form-group">
                                <label for="dispatchPayment">Payment Method</label>
                                <select id="dispatchPayment">
                                    <option value="cash">Cash</option>
                                    <option value="card">Credit Card</option>
                                    <option value="mobile">Mobile Payment</option>
                                    <option value="account">Account</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="dispatchNotes">Special Instructions</label>
                            <textarea id="dispatchNotes" rows="3" placeholder="Any special requests or instructions"></textarea>
                        </div>
                        
                        <div class="button-group">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-taxi"></i> Create Trip Request
                            </button>
                            <button type="button" class="btn btn-success" onclick="findAvailableDrivers()">
                                <i class="fas fa-search"></i> Find Available Drivers
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="active-trips">
                    <h3 class="section-title">Available Drivers</h3>
                    
                    <div class="search-container">
                        <input type="text" class="search-box" id="driverSearch" placeholder="Search drivers by name or location...">
                    </div>
                    
                    <div class="filter-buttons">
                        <button class="filter-btn active" onclick="filterDrivers('all')">All</button>
                        <button class="filter-btn" onclick="filterDrivers('available')">Available</button>
                        <button class="filter-btn" onclick="filterDrivers('nearby')">Nearby</button>
                        <button class="filter-btn" onclick="filterDrivers('rated')">Top Rated</button>
                    </div>
                    
                    <div id="availableDriversList">
                        <!-- Available drivers will be dynamically inserted here -->
                        <p style="text-align: center; color: #7f8c8d; padding: 20px;">Loading available drivers...</p>
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 30px;">
                <h3 class="section-title">Pending Trip Requests</h3>
                <table id="pendingTripsTable">
                    <thead>
                        <tr>
                            <th>Request ID</th>
                            <th>Customer</th>
                            <th>Pickup</th>
                            <th>Destination</th>
                            <th>Time</th>
                            <th>Fare</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="pendingTripsBody">
                        <!-- Pending trips will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Trips Tab -->
        <div id="trips-tab" class="tab-content">
            <h2 class="section-title">Trip Management</h2>
            
            <div class="search-container">
                <input type="text" class="search-box" id="tripSearch" placeholder="Search trips by ID, customer, or driver...">
            </div>
            
            <div class="filter-buttons">
                <button class="filter-btn active" onclick="filterTrips('all')">All Trips</button>
                <button class="filter-btn" onclick="filterTrips('active')">Active</button>
                <button class="filter-btn" onclick="filterTrips('completed')">Completed</button>
                <button class="filter-btn" onclick="filterTrips('today')">Today</button>
                <button class="filter-btn" onclick="filterTrips('cancelled')">Cancelled</button>
            </div>
            
            <table id="allTripsTable">
                <thead>
                    <tr>
                        <th>Trip ID</th>
                        <th>Customer</th>
                        <th>Driver</th>
                        <th>Pickup</th>
                        <th>Destination</th>
                        <th>Start Time</th>
                        <th>End Time</th>
                        <th>Fare</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="allTripsBody">
                    <!-- All trips will be inserted here -->
                </tbody>
            </table>
            
            <div class="button-group" style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="exportTrips()">
                    <i class="fas fa-file-export"></i> Export Trips to CSV
                </button>
                <button class="btn btn-warning" onclick="clearCompletedTrips()">
                    <i class="fas fa-trash"></i> Clear Completed Trips
                </button>
            </div>
        </div>
        
        <!-- Drivers Tab -->
        <div id="drivers-tab" class="tab-content">
            <h2 class="section-title">Driver Management</h2>
            
            <div class="dashboard" style="margin-bottom: 30px;">
                <div class="dashboard-card">
                    <div class="card-title">Total Drivers</div>
                    <div class="card-value" id="totalDrivers">0</div>
                </div>
                <div class="dashboard-card">
                    <div class="card-title">On Duty</div>
                    <div class="card-value" id="onDutyDrivers">0</div>
                </div>
                <div class="dashboard-card">
                    <div class="card-title">Available Now</div>
                    <div class="card-value positive" id="availableNowDrivers">0</div>
                </div>
                <div class="dashboard-card">
                    <div class="card-title">Avg. Rating</div>
                    <div class="card-value" id="avgRating">0.0</div>
                </div>
            </div>
            
            <div class="button-group" style="margin-bottom: 20px;">
                <button class="btn btn-success" onclick="openAddDriverModal()">
                    <i class="fas fa-user-plus"></i> Add New Driver
                </button>
                <button class="btn btn-primary" onclick="refreshDriverStatus()">
                    <i class="fas fa-sync-alt"></i> Refresh Status
                </button>
                <button class="btn btn-warning" onclick="exportDriverData()">
                    <i class="fas fa-file-export"></i> Export Driver Data
                </button>
            </div>
            
            <table id="driversTable">
                <thead>
                    <tr>
                        <th>Driver ID</th>
                        <th>Name</th>
                        <th>Vehicle</th>
                        <th>Status</th>
                        <th>Current Location</th>
                        <th>Trips Today</th>
                        <th>Rating</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="driversTableBody">
                    <!-- Drivers will be inserted here -->
                </tbody>
            </table>
        </div>
        
        <!-- Reports Tab -->
        <div id="reports-tab" class="tab-content">
            <h2 class="section-title">Dispatch Reports & Analytics</h2>
            
            <div class="dashboard">
                <div class="dashboard-card">
                    <div class="card-title">Today's Trips</div>
                    <div class="card-value" id="reportTodayTrips">0</div>
                </div>
                <div class="dashboard-card">
                    <div class="card-title">Today's Revenue</div>
                    <div class="card-value positive" id="reportTodayRevenue">$0.00</div>
                </div>
                <div class="dashboard-card">
                    <div class="card-title">This Week's Trips</div>
                    <div class="card-value" id="reportWeekTrips">0</div>
                </div>
                <div class="dashboard-card">
                    <div class="card-title">Avg. Trip Duration</div>
                    <div class="card-value" id="reportAvgDuration">0 min</div>
                </div>
            </div>
            
            <div class="dispatch-container" style="margin-top: 30px;">
                <div class="dispatch-form">
                    <h3 class="section-title">Generate Report</h3>
                    
                    <div class="form-group">
                        <label for="reportType">Report Type</label>
                        <select id="reportType">
                            <option value="daily">Daily Summary</option>
                            <option value="weekly">Weekly Summary</option>
                            <option value="monthly">Monthly Summary</option>
                            <option value="driver">Driver Performance</option>
                            <option value="revenue">Revenue Analysis</option>
                        </select>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="reportStartDate">Start Date</label>
                            <input type="date" id="reportStartDate">
                        </div>
                        <div class="form-group">
                            <label for="reportEndDate">End Date</label>
                            <input type="date" id="reportEndDate">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="reportDriver">Driver (Optional)</label>
                        <select id="reportDriver">
                            <option value="all">All Drivers</option>
                            <!-- Driver options will be populated dynamically -->
                        </select>
                    </div>
                    
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="generateReport()">
                            <i class="fas fa-chart-line"></i> Generate Report
                        </button>
                        <button class="btn btn-success" onclick="exportReport()">
                            <i class="fas fa-file-excel"></i> Export to LibreOffice
                        </button>
                    </div>
                </div>
                
                <div class="active-trips">
                    <h3 class="section-title">Report Preview</h3>
                    
                    <div id="reportPreview" style="padding: 20px; background-color: #f8f9fa; border-radius: 8px; min-height: 300px;">
                        <p style="text-align: center; color: #7f8c8d; padding: 20px;">
                            Select report parameters and click "Generate Report"
                        </p>
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 30px;">
                <h3 class="section-title">Top Performers (This Month)</h3>
                <table id="topPerformersTable">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Driver</th>
                            <th>Trips</th>
                            <th>Revenue</th>
                            <th>Avg. Rating</th>
                            <th>Efficiency</th>
                        </tr>
                    </thead>
                    <tbody id="topPerformersBody">
                        <!-- Top performers will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <footer>
            <p>Taxi Dispatch System v2.0 | Real-time dispatching with driver and trip management</p>
            <p>© 2023 Taxi Dispatch System. All data is stored locally in your browser.</p>
        </footer>
    </div>
    
    <!-- Add Driver Modal -->
    <div id="addDriverModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeAddDriverModal()">&times;</span>
            <h2>Add New Driver</h2>
            <form id="addDriverForm">
                <div class="form-group">
                    <label for="newDriverName">Driver Name *</label>
                    <input type="text" id="newDriverName" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="newDriverPhone">Phone *</label>
                        <input type="tel" id="newDriverPhone" required>
                    </div>
                    <div class="form-group">
                        <label for="newDriverLicense">License Number</label>
                        <input type="text" id="newDriverLicense">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="newDriverVehicle">Vehicle *</label>
                    <input type="text" id="newDriverVehicle" placeholder="Make, Model, Year" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="newDriverColor">Vehicle Color</label>
                        <input type="text" id="newDriverColor">
                    </div>
                    <div class="form-group">
                        <label for="newDriverPlate">Plate Number *</label>
                        <input type="text" id="newDriverPlate" required>
                    </div>
                </div>
                
                <div class="button-group">
                    <button type="submit" class="btn btn-success">Add Driver</button>
                    <button type="button" class="btn btn-warning" onclick="closeAddDriverModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Trip Details Modal -->
    <div id="tripDetailsModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeTripDetailsModal()">&times;</span>
            <h2>Trip Details</h2>
            <div id="tripDetailsContent">
                <!-- Trip details will be inserted here -->
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let trips = [];
        let drivers = [];
        let currentTab = 'dashboard';
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Set default dates for reports
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('reportStartDate').value = today;
            document.getElementById('reportEndDate').value = today;
            
            // Set default time for dispatch (current time + 10 minutes)
            const now = new Date();
            now.setMinutes(now.getMinutes() + 10);
            document.getElementById('dispatchTime').value = now.toISOString().slice(0, 16);
            
            // Load data from localStorage
            loadTrips();
            loadDrivers();
            
            // Initialize with sample data if empty
            if (drivers.length === 0) {
                initializeSampleDrivers();
            }
            
            if (trips.length === 0) {
                initializeSampleTrips();
            }
            
            // Set up event listeners
            document.getElementById('quickDispatchForm').addEventListener('submit', quickDispatch);
            document.getElementById('dispatchForm').addEventListener('submit', createTripRequest);
            document.getElementById('addDriverForm').addEventListener('submit', addNewDriver);
            
            // Set up search functionality
            document.getElementById('driverSearch').addEventListener('input', searchDrivers);
            document.getElementById('tripSearch').addEventListener('input', searchTrips);
            
            // Update dashboard
            updateDashboard();
            updateDriverManagement();
            updateReports();
            
            // Simulate real-time updates
            setInterval(simulateRealTimeUpdates, 10000);
        });
        
        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // Activate selected tab button
            document.querySelectorAll('.tab').forEach(tab => {
                if (tab.textContent.includes(tabName.charAt(0).toUpperCase() + tabName.slice(1)) || 
                    tab.textContent.includes('Dashboard') && tabName === 'dashboard') {
                    tab.classList.add('active');
                }
            });
            
            currentTab = tabName;
            
            // Update tab-specific content
            if (tabName === 'dispatch') {
                updateAvailableDriversList();
                updatePendingTrips();
            } else if (tabName === 'trips') {
                updateAllTripsTable();
            } else if (tabName === 'drivers') {
                updateDriverManagement();
            } else if (tabName === 'reports') {
                updateReports();
            }
        }
        
        // Load trips from localStorage
        function loadTrips() {
            const savedTrips = localStorage.getItem('taxiDispatchTrips');
            if (savedTrips) {
                trips = JSON.parse(savedTrips);
            }
        }
        
        // Save trips to localStorage
        function saveTrips() {
            localStorage.setItem('taxiDispatchTrips', JSON.stringify(trips));
        }
        
        // Load drivers from localStorage
        function loadDrivers() {
            const savedDrivers = localStorage.getItem('taxiDispatchDrivers');
            if (savedDrivers) {
                drivers = JSON.parse(savedDrivers);
            }
        }
        
        // Save drivers to localStorage
        function saveDrivers() {
            localStorage.setItem('taxiDispatchDrivers', JSON.stringify(drivers));
        }
        
        // Initialize with sample drivers
        function initializeSampleDrivers() {
            drivers = [
                {
                    id: 'DRV-001',
                    name: 'John Smith',
                    phone: '(555) 123-4567',
                    license: 'DL123456',
                    vehicle: 'Toyota Camry 2020',
                    color: 'Blue',
                    plate: 'ABC-123',
                    status: 'available',
                    location: 'Downtown',
                    rating: 4.8,
                    tripsToday: 3,
                    totalTrips: 124
                },
                {
                    id: 'DRV-002',
                    name: 'Maria Garcia',
                    phone: '(555) 234-5678',
                    license: 'DL234567',
                    vehicle: 'Honda Accord 2019',
                    color: 'White',
                    plate: 'DEF-456',
                    status: 'busy',
                    location: 'Airport',
                    rating: 4.6,
                    tripsToday: 5,
                    totalTrips: 89
                },
                {
                    id: 'DRV-003',
                    name: 'Robert Johnson',
                    phone: '(555) 345-6789',
                    license: 'DL345678',
                    vehicle: 'Ford Explorer 2021',
                    color: 'Black',
                    plate: 'GHI-789',
                    status: 'available',
                    location: 'North District',
                    rating: 4.9,
                    tripsToday: 2,
                    totalTrips: 156
                },
                {
                    id: 'DRV-004',
                    name: 'Lisa Chen',
                    phone: '(555) 456-7890',
                    license: 'DL456789',
                    vehicle: 'Toyota Prius 2022',
                    color: 'Red',
                    plate: 'JKL-012',
                    status: 'offline',
                    location: 'West End',
                    rating: 4.7,
                    tripsToday: 0,
                    totalTrips: 67
                }
            ];
            saveDrivers();
        }
        
        // Initialize with sample trips
        function initializeSampleTrips() {
            const now = new Date();
            const oneHourAgo = new Date(now.getTime() - 60 * 60 * 1000);
            const twoHoursAgo = new Date(now.getTime() - 2 * 60 * 60 * 1000);
            
            trips = [
                {
                    id: 'TRIP-' + Date.now().toString().slice(-6),
                    customerName: 'Michael Brown',
                    customerPhone: '(555) 567-8901',
                    pickup: '123 Main St, Downtown',
                    dropoff: 'International Airport',
                    driverId: 'DRV-002',
                    driverName: 'Maria Garcia',
                    status: 'ongoing',
                    fare: 45.50,
                    payment: 'card',
                    startTime: oneHourAgo.toISOString(),
                    estimatedDuration: 35,
                    passengers: 2,
                    vehicleType: 'sedan',
                    notes: 'Flight at 3 PM, need prompt service'
                },
                {
                    id: 'TRIP-' + (Date.now() - 100000).toString().slice(-6),
                    customerName: 'Sarah Williams',
                    customerPhone: '(555) 678-9012',
                    pickup: '456 Oak Ave, North District',
                    dropoff: 'Central Station',
                    driverId: 'DRV-001',
                    driverName: 'John Smith',
                    status: 'completed',
                    fare: 22.75,
                    payment: 'cash',
                    startTime: twoHoursAgo.toISOString(),
                    endTime: new Date(twoHoursAgo.getTime() + 25 * 60 * 1000).toISOString(),
                    estimatedDuration: 25,
                    passengers: 1,
                    vehicleType: 'sedan',
                    notes: ''
                },
                {
                    id: 'TRIP-' + (Date.now() - 200000).toString().slice(-6),
                    customerName: 'David Miller',
                    customerPhone: '(555) 789-0123',
                    pickup: '789 Pine Rd, East Side',
                    dropoff: 'Convention Center',
                    driverId: null,
                    driverName: null,
                    status: 'pending',
                    fare: 18.25,
                    payment: 'mobile',
                    requestedTime: new Date().toISOString(),
                    estimatedDuration: 15,
                    passengers: 3,
                    vehicleType: 'suv',
                    notes: 'Corporate account'
                }
            ];
            saveTrips();
        }
        
        // Update dashboard
        function updateDashboard() {
            // Count available drivers
            const availableDriversCount = drivers.filter(d => d.status === 'available').length;
            document.getElementById('availableDrivers').textContent = availableDriversCount;
            
            // Count active trips
            const activeTripsCount = trips.filter(t => t.status === 'ongoing' || t.status === 'assigned').length;
            document.getElementById('activeTrips').textContent = activeTripsCount;
            
            // Calculate today's revenue
            const today = new Date().toDateString();
            const todayRevenue = trips
                .filter(t => {
                    const tripDate = new Date(t.startTime || t.requestedTime).toDateString();
                    return tripDate === today && t.status === 'completed';
                })
                .reduce((sum, t) => sum + t.fare, 0);
            document.getElementById('todayRevenue').textContent = '$' + todayRevenue.toFixed(2);
            
            // Count pending requests
            const pendingRequestsCount = trips.filter(t => t.status === 'pending').length;
            document.getElementById('pendingRequests').textContent = pendingRequestsCount;
            
            // Update notification badge
            document.getElementById('pendingTripsBadge').textContent = pendingRequestsCount;
            
            // Update active trips list
            updateActiveTripsList();
            
            // Update recent trips table
            updateRecentTripsTable();
        }
        
        // Update active trips list on dashboard
        function updateActiveTripsList() {
            const activeTripsList = document.getElementById('activeTripsList');
            const activeTrips = trips.filter(t => t.status === 'ongoing' || t.status === 'assigned');
            
            if (activeTrips.length === 0) {
                activeTripsList.innerHTML = '<p style="text-align: center; color: #7f8c8d; padding: 20px;">No active trips at the moment</p>';
                return;
            }
            
            let html = '';
            activeTrips.forEach(trip => {
                html += `
                    <div style="padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600;">${trip.customerName}</div>
                            <div style="font-size: 0.9rem; color: #7f8c8d;">
                                ${trip.pickup} → ${trip.dropoff}
                            </div>
                            <div style="font-size: 0.8rem; margin-top: 5px;">
                                Driver: <span style="font-weight: 600;">${trip.driverName || 'Not assigned'}</span>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-weight: 600; color: #2ecc71;">$${trip.fare.toFixed(2)}</div>
                            <div style="font-size: 0.8rem;">
                                <span class="status ${getStatusClass(trip.status)}">${trip.status.toUpperCase()}</span>
                            </div>
                            <button class="action-btn" style="background-color: #3498db; color: white; margin-top: 8px;" onclick="viewTripDetails('${trip.id}')">
                                View
                            </button>
                        </div>
                    </div>
                `;
            });
            
            activeTripsList.innerHTML = html;
        }
        
        // Update recent trips table
        function updateRecentTripsTable() {
            const tableBody = document.getElementById('recentTripsBody');
            const recentTrips = [...trips]
                .sort((a, b) => new Date(b.startTime || b.requestedTime) - new Date(a.startTime || a.requestedTime))
                .slice(0, 5);
            
            let html = '';
            recentTrips.forEach(trip => {
                html += `
                    <tr>
                        <td>${trip.id}</td>
                        <td>${trip.customerName}</td>
                        <td>${trip.driverName || 'Not assigned'}</td>
                        <td>${truncateText(trip.pickup, 20)}</td>
                        <td><span class="status ${getStatusClass(trip.status)}">${trip.status.toUpperCase()}</span></td>
                        <td>$${trip.fare.toFixed(2)}</td>
                        <td class="action-buttons">
                            <button class="action-btn" style="background-color: #3498db; color: white;" onclick="viewTripDetails('${trip.id}')">View</button>
                            ${trip.status === 'pending' ? `<button class="action-btn" style="background-color: #2ecc71; color: white;" onclick="assignDriverToTrip('${trip.id}')">Assign</button>` : ''}
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html || '<tr><td colspan="7" style="text-align: center; color: #7f8c8d;">No trips found</td></tr>';
        }
        
        // Quick dispatch form
        function quickDispatch(event) {
            event.preventDefault();
            
            const customerName = document.getElementById('customerName').value;
            const customerPhone = document.getElementById('customerPhone').value;
            const pickup = document.getElementById('pickupLocation').value;
            const dropoff = document.getElementById('dropoffLocation').value;
            const passengers = document.getElementById('passengers').value;
            const tripType = document.getElementById('tripType').value;
            const priority = document.getElementById('priority').value;
            
            // Calculate fare based on trip type and priority
            let baseFare = 15.00;
            if (tripType === 'airport') baseFare = 35.00;
            if (tripType === 'city') baseFare = 50.00;
            if (tripType === 'hourly') baseFare = 60.00;
            
            if (priority === 'high') baseFare *= 1.2;
            if (priority === 'urgent') baseFare *= 1.5;
            
            // Create trip
            const trip = {
                id: 'TRIP-' + Date.now().toString().slice(-6),
                customerName,
                customerPhone,
                pickup,
                dropoff,
                passengers: parseInt(passengers),
                tripType,
                priority,
                status: 'pending',
                fare: baseFare,
                payment: 'cash',
                requestedTime: new Date().toISOString(),
                estimatedDuration: 20,
                vehicleType: passengers > 3 ? 'suv' : 'sedan'
            };
            
            trips.push(trip);
            saveTrips();
            updateDashboard();
            
            // Try to auto-assign a driver
            autoAssignDriver(trip.id);
            
            // Show success message
            showAlert('Trip created successfully! Attempting to assign a driver...', 'success');
            
            // Reset form
            event.target.reset();
        }
        
        // Auto assign driver to trip
        function autoAssignDriver(tripId) {
            const trip = trips.find(t => t.id === tripId);
            if (!trip) return;
            
            // Find available drivers matching vehicle type
            const availableDrivers = drivers.filter(d => 
                d.status === 'available' && 
                (trip.vehicleType === 'any' || d.vehicle.toLowerCase().includes(trip.vehicleType))
            );
            
            if (availableDrivers.length > 0) {
                // Sort by rating (highest first)
                availableDrivers.sort((a, b) => b.rating - a.rating);
                
                // Assign the best driver
                const driver = availableDrivers[0];
                trip.driverId = driver.id;
                trip.driverName = driver.name;
                trip.status = 'assigned';
                
                // Update driver status
                driver.status = 'busy';
                
                saveTrips();
                saveDrivers();
                updateDashboard();
                
                showAlert(`Driver ${driver.name} assigned to trip ${tripId}`, 'success');
            }
        }
        
        // Auto dispatch - finds best driver for a new trip
        function autoDispatch() {
            // Create a trip from form data
            const customerName = document.getElementById('customerName').value || 'Auto Customer';
            const customerPhone = document.getElementById('customerPhone').value || '(555) 000-0000';
            const pickup = document.getElementById('pickupLocation').value || 'City Center';
            const dropoff = document.getElementById('dropoffLocation').value || 'Unknown Destination';
            
            if (!pickup || !dropoff) {
                showAlert('Please enter pickup and drop-off locations', 'error');
                return;
            }
            
            const trip = {
                id: 'TRIP-' + Date.now().toString().slice(-6),
                customerName,
                customerPhone,
                pickup,
                dropoff,
                status: 'pending',
                fare: 25.00,
                payment: 'cash',
                requestedTime: new Date().toISOString(),
                estimatedDuration: 20,
                vehicleType: 'sedan'
            };
            
            trips.push(trip);
            saveTrips();
            
            // Auto assign
            autoAssignDriver(trip.id);
            
            // Update UI
            updateDashboard();
            showAlert('Auto-dispatch completed!', 'success');
        }
        
        // Create trip request from dispatch form
        function createTripRequest(event) {
            event.preventDefault();
            
            const customerName = document.getElementById('dispatchCustomerName').value;
            const customerPhone = document.getElementById('dispatchCustomerPhone').value;
            const pickup = document.getElementById('dispatchPickup').value;
            const dropoff = document.getElementById('dispatchDropoff').value;
            const dispatchTime = document.getElementById('dispatchTime').value;
            const vehicleType = document.getElementById('dispatchVehicleType').value;
            const fare = parseFloat(document.getElementById('dispatchFare').value) || 20.00;
            const payment = document.getElementById('dispatchPayment').value;
            const notes = document.getElementById('dispatchNotes').value;
            
            // Create trip
            const trip = {
                id: 'TRIP-' + Date.now().toString().slice(-6),
                customerName,
                customerPhone,
                pickup,
                dropoff,
                status: 'pending',
                fare,
                payment,
                requestedTime: dispatchTime || new Date().toISOString(),
                estimatedDuration: 25,
                vehicleType,
                notes
            };
            
            trips.push(trip);
            saveTrips();
            updateDashboard();
            updatePendingTrips();
            
            showAlert('Trip request created successfully!', 'success');
            event.target.reset();
            
            // Set default time for next request
            const now = new Date();
            now.setMinutes(now.getMinutes() + 10);
            document.getElementById('dispatchTime').value = now.toISOString().slice(0, 16);
        }
        
        // Update available drivers list
        function updateAvailableDriversList() {
            const driversList = document.getElementById('availableDriversList');
            
            let html = '';
            drivers.forEach(driver => {
                const statusClass = driver.status === 'available' ? 'driver-available' : 
                                  driver.status === 'busy' ? 'driver-busy' : 'driver-offline';
                
                html += `
                    <div style="padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600;">
                                <span class="driver-status ${statusClass}"></span>
                                ${driver.name}
                            </div>
                            <div style="font-size: 0.9rem; color: #7f8c8d;">
                                ${driver.vehicle} • ${driver.plate}
                            </div>
                            <div style="font-size: 0.8rem; margin-top: 5px;">
                                <i class="fas fa-star" style="color: #f39c12;"></i> ${driver.rating} • ${driver.location}
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 0.9rem; color: #2c3e50;">
                                ${driver.tripsToday} trips today
                            </div>
                            <button class="action-btn" style="background-color: ${driver.status === 'available' ? '#2ecc71' : '#95a5a6'}; color: white; margin-top: 8px;" 
                                    onclick="assignDriverManually('${driver.id}')" ${driver.status !== 'available' ? 'disabled' : ''}>
                                ${driver.status === 'available' ? 'Assign' : driver.status === 'busy' ? 'Busy' : 'Offline'}
                            </button>
                        </div>
                    </div>
                `;
            });
            
            driversList.innerHTML = html || '<p style="text-align: center; color: #7f8c8d; padding: 20px;">No drivers available</p>';
        }
        
        // Update pending trips table
        function updatePendingTrips() {
            const tableBody = document.getElementById('pendingTripsBody');
            const pendingTrips = trips.filter(t => t.status === 'pending');
            
            let html = '';
            pendingTrips.forEach(trip => {
                html += `
                    <tr>
                        <td>${trip.id}</td>
                        <td>${trip.customerName}<br><small>${trip.customerPhone}</small></td>
                        <td>${truncateText(trip.pickup, 25)}</td>
                        <td>${truncateText(trip.dropoff, 25)}</td>
                        <td>${formatTime(trip.requestedTime)}</td>
                        <td>$${trip.fare.toFixed(2)}</td>
                        <td><span class="status status-pending">PENDING</span></td>
                        <td class="action-buttons">
                            <button class="action-btn" style="background-color: #3498db; color: white;" onclick="viewTripDetails('${trip.id}')">View</button>
                            <button class="action-btn" style="background-color: #2ecc71; color: white;" onclick="assignDriverToTrip('${trip.id}')">Assign</button>
                            <button class="action-btn" style="background-color: #e74c3c; color: white;" onclick="cancelTrip('${trip.id}')">Cancel</button>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html || '<tr><td colspan="8" style="text-align: center; color: #7f8c8d;">No pending trips</td></tr>';
        }
        
        // Assign driver to trip manually
        function assignDriverManually(driverId) {
            // Get first pending trip
            const pendingTrip = trips.find(t => t.status === 'pending');
            if (!pendingTrip) {
                showAlert('No pending trips to assign', 'error');
                return;
            }
            
            const driver = drivers.find(d => d.id === driverId);
            if (!driver || driver.status !== 'available') {
                showAlert('Driver is not available', 'error');
                return;
            }
            
            // Assign driver
            pendingTrip.driverId = driverId;
            pendingTrip.driverName = driver.name;
            pendingTrip.status = 'assigned';
            
            // Update driver status
            driver.status = 'busy';
            
            saveTrips();
            saveDrivers();
            updateDashboard();
            updatePendingTrips();
            updateAvailableDriversList();
            
            showAlert(`Driver ${driver.name} assigned to trip ${pendingTrip.id}`, 'success');
        }
        
        // Assign driver to specific trip
        function assignDriverToTrip(tripId) {
            const trip = trips.find(t => t.id === tripId);
            if (!trip) return;
            
            // Find available drivers
            const availableDrivers = drivers.filter(d => d.status === 'available');
            if (availableDrivers.length === 0) {
                showAlert('No available drivers at the moment', 'error');
                return;
            }
            
            // Show driver selection (in a real app, this would be a modal)
            let driverOptions = '';
            availableDrivers.forEach(driver => {
                driverOptions += `<option value="${driver.id}">${driver.name} - ${driver.vehicle} (${driver.rating}★)</option>`;
            });
            
            const selectedDriverId = prompt(`Select a driver for trip ${tripId}:\n\n${driverOptions}`);
            if (!selectedDriverId) return;
            
            const driver = drivers.find(d => d.id === selectedDriverId);
            if (!driver) return;
            
            // Assign driver
            trip.driverId = driver.id;
            trip.driverName = driver.name;
            trip.status = 'assigned';
            
            // Update driver status
            driver.status = 'busy';
            
            saveTrips();
            saveDrivers();
            updateDashboard();
            updatePendingTrips();
            updateAvailableDriversList();
            
            showAlert(`Driver ${driver.name} assigned to trip ${tripId}`, 'success');
        }
        
        // Find available drivers
        function findAvailableDrivers() {
            const availableDrivers = drivers.filter(d => d.status === 'available');
            
            if (availableDrivers.length === 0) {
                showAlert('No available drivers found', 'error');
                return;
            }
            
            let message = `Available Drivers (${availableDrivers.length}):\n\n`;
            availableDrivers.forEach(driver => {
                message += `• ${driver.name} - ${driver.vehicle} - ${driver.location} - ${driver.rating}★\n`;
            });
            
            alert(message);
        }
        
        // Update all trips table
        function updateAllTripsTable() {
            const tableBody = document.getElementById('allTripsBody');
            
            let html = '';
            trips.forEach(trip => {
                html += `
                    <tr>
                        <td>${trip.id}</td>
                        <td>${trip.customerName}</td>
                        <td>${trip.driverName || 'Not assigned'}</td>
                        <td>${truncateText(trip.pickup, 20)}</td>
                        <td>${truncateText(trip.dropoff, 20)}</td>
                        <td>${formatTime(trip.startTime || trip.requestedTime)}</td>
                        <td>${trip.endTime ? formatTime(trip.endTime) : '--'}</td>
                        <td>$${trip.fare.toFixed(2)}</td>
                        <td><span class="status ${getStatusClass(trip.status)}">${trip.status.toUpperCase()}</span></td>
                        <td class="action-buttons">
                            <button class="action-btn" style="background-color: #3498db; color: white;" onclick="viewTripDetails('${trip.id}')">View</button>
                            ${trip.status === 'ongoing' ? `<button class="action-btn" style="background-color: #2ecc71; color: white;" onclick="completeTrip('${trip.id}')">Complete</button>` : ''}
                            ${trip.status === 'pending' || trip.status === 'assigned' ? `<button class="action-btn" style="background-color: #e74c3c; color: white;" onclick="cancelTrip('${trip.id}')">Cancel</button>` : ''}
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html || '<tr><td colspan="10" style="text-align: center; color: #7f8c8d;">No trips found</td></tr>';
        }
        
        // Update driver management section
        function updateDriverManagement() {
            const tableBody = document.getElementById('driversTableBody');
            
            // Update dashboard cards
            document.getElementById('totalDrivers').textContent = drivers.length;
            document.getElementById('onDutyDrivers').textContent = drivers.filter(d => d.status !== 'offline').length;
            document.getElementById('availableNowDrivers').textContent = drivers.filter(d => d.status === 'available').length;
            
            const totalRating = drivers.reduce((sum, d) => sum + d.rating, 0);
            const avgRating = drivers.length > 0 ? (totalRating / drivers.length).toFixed(1) : '0.0';
            document.getElementById('avgRating').textContent = avgRating;
            
            // Update table
            let html = '';
            drivers.forEach(driver => {
                const statusClass = driver.status === 'available' ? 'driver-available' : 
                                  driver.status === 'busy' ? 'driver-busy' : 'driver-offline';
                const statusText = driver.status === 'available' ? 'Available' : 
                                 driver.status === 'busy' ? 'On Trip' : 'Offline';
                
                html += `
                    <tr>
                        <td>${driver.id}</td>
                        <td>${driver.name}<br><small>${driver.phone}</small></td>
                        <td>${driver.vehicle}<br><small>${driver.color} • ${driver.plate}</small></td>
                        <td><span class="driver-status ${statusClass}"></span> ${statusText}</td>
                        <td>${driver.location}</td>
                        <td>${driver.tripsToday}</td>
                        <td>
                            <i class="fas fa-star" style="color: #f39c12;"></i> ${driver.rating}
                            <br><small>${driver.totalTrips} total trips</small>
                        </td>
                        <td class="action-buttons">
                            <button class="action-btn" style="background-color: #3498db; color: white;" onclick="viewDriverDetails('${driver.id}')">View</button>
                            <button class="action-btn" style="background-color: ${driver.status === 'available' ? '#e74c3c' : '#2ecc71'}; color: white;" 
                                    onclick="toggleDriverStatus('${driver.id}')">
                                ${driver.status === 'available' ? 'Set Busy' : 'Set Available'}
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html || '<tr><td colspan="8" style="text-align: center; color: #7f8c8d;">No drivers found</td></tr>';
        }
        
        // Update reports section
        function updateReports() {
            // Update report dashboard cards
            const today = new Date().toDateString();
            const todayTrips = trips.filter(t => {
                const tripDate = new Date(t.startTime || t.requestedTime).toDateString();
                return tripDate === today;
            }).length;
            
            document.getElementById('reportTodayTrips').textContent = todayTrips;
            
            const todayRevenue = trips
                .filter(t => {
                    const tripDate = new Date(t.startTime || t.requestedTime).toDateString();
                    return tripDate === today && t.status === 'completed';
                })
                .reduce((sum, t) => sum + t.fare, 0);
            document.getElementById('reportTodayRevenue').textContent = '$' + todayRevenue.toFixed(2);
            
            // This week's trips (simplified)
            const weekTrips = trips.filter(t => t.status === 'completed').length;
            document.getElementById('reportWeekTrips').textContent = weekTrips;
            
            // Average trip duration (simplified)
            document.getElementById('reportAvgDuration').textContent = '25 min';
            
            // Update top performers
            updateTopPerformers();
        }
        
        // Update top performers table
        function updateTopPerformers() {
            const tableBody = document.getElementById('topPerformersBody');
            
            // Sort drivers by trips today
            const sortedDrivers = [...drivers]
                .sort((a, b) => b.tripsToday - a.tripsToday)
                .slice(0, 5);
            
            let html = '';
            sortedDrivers.forEach((driver, index) => {
                // Calculate revenue (simplified: $15 per trip)
                const revenue = driver.tripsToday * 15;
                
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${driver.name}</td>
                        <td>${driver.tripsToday}</td>
                        <td>$${revenue.toFixed(2)}</td>
                        <td>
                            <i class="fas fa-star" style="color: #f39c12;"></i> ${driver.rating}
                        </td>
                        <td>${(driver.rating * 20).toFixed(0)}%</td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html || '<tr><td colspan="6" style="text-align: center; color: #7f8c8d;">No data available</td></tr>';
        }
        
        // Generate report
        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            const driverId = document.getElementById('reportDriver').value;
            
            // Filter trips based on criteria
            let filteredTrips = [...trips];
            
            // Filter by date range
            if (startDate && endDate) {
                filteredTrips = filteredTrips.filter(trip => {
                    const tripDate = new Date(trip.startTime || trip.requestedTime).toISOString().split('T')[0];
                    return tripDate >= startDate && tripDate <= endDate;
                });
            }
            
            // Filter by driver
            if (driverId !== 'all') {
                filteredTrips = filteredTrips.filter(trip => trip.driverId === driverId);
            }
            
            // Filter by status (for certain report types)
            if (reportType === 'revenue') {
                filteredTrips = filteredTrips.filter(trip => trip.status === 'completed');
            }
            
            // Generate report content
            let reportContent = '';
            
            if (reportType === 'daily') {
                reportContent = generateDailyReport(filteredTrips);
            } else if (reportType === 'weekly') {
                reportContent = generateWeeklyReport(filteredTrips);
            } else if (reportType === 'monthly') {
                reportContent = generateMonthlyReport(filteredTrips);
            } else if (reportType === 'driver') {
                reportContent = generateDriverReport(filteredTrips);
            } else if (reportType === 'revenue') {
                reportContent = generateRevenueReport(filteredTrips);
            }
            
            // Display report
            document.getElementById('reportPreview').innerHTML = reportContent;
        }
        
        // Generate daily report
        function generateDailyReport(trips) {
            const totalTrips = trips.length;
            const completedTrips = trips.filter(t => t.status === 'completed').length;
            const totalRevenue = trips.filter(t => t.status === 'completed').reduce((sum, t) => sum + t.fare, 0);
            const avgFare = completedTrips > 0 ? totalRevenue / completedTrips : 0;
            
            return `
                <h3>Daily Dispatch Report</h3>
                <p><strong>Report Date:</strong> ${new Date().toLocaleDateString()}</p>
                <div style="margin: 20px 0;">
                    <div class="summary-item"><span>Total Trips:</span><span>${totalTrips}</span></div>
                    <div class="summary-item"><span>Completed Trips:</span><span>${completedTrips}</span></div>
                    <div class="summary-item"><span>Cancelled Trips:</span><span>${trips.filter(t => t.status === 'cancelled').length}</span></div>
                    <div class="summary-item"><span>Total Revenue:</span><span>$${totalRevenue.toFixed(2)}</span></div>
                    <div class="summary-item"><span>Average Fare:</span><span>$${avgFare.toFixed(2)}</span></div>
                </div>
                <h4>Trip Breakdown</h4>
                <p>Pending: ${trips.filter(t => t.status === 'pending').length}</p>
                <p>Assigned: ${trips.filter(t => t.status === 'assigned').length}</p>
                <p>Ongoing: ${trips.filter(t => t.status === 'ongoing').length}</p>
                <p>Completed: ${completedTrips}</p>
            `;
        }
        
        // Generate weekly report (simplified)
        function generateWeeklyReport(trips) {
            return generateDailyReport(trips) + '<p><em>Weekly data aggregated from daily reports.</em></p>';
        }
        
        // Generate monthly report (simplified)
        function generateMonthlyReport(trips) {
            return generateDailyReport(trips) + '<p><em>Monthly data aggregated from daily reports.</em></p>';
        }
        
        // Generate driver report
        function generateDriverReport(trips) {
            // Group trips by driver
            const driverTrips = {};
            trips.forEach(trip => {
                if (trip.driverId) {
                    if (!driverTrips[trip.driverId]) {
                        driverTrips[trip.driverId] = {
                            name: trip.driverName,
                            trips: 0,
                            revenue: 0,
                            completed: 0
                        };
                    }
                    driverTrips[trip.driverId].trips++;
                    if (trip.status === 'completed') {
                        driverTrips[trip.driverId].revenue += trip.fare;
                        driverTrips[trip.driverId].completed++;
                    }
                }
            });
            
            let reportContent = '<h3>Driver Performance Report</h3>';
            
            for (const driverId in driverTrips) {
                const driver = driverTrips[driverId];
                const completionRate = driver.trips > 0 ? (driver.completed / driver.trips * 100).toFixed(1) : 0;
                
                reportContent += `
                    <div style="padding: 15px; background-color: #f8f9fa; border-radius: 8px; margin-bottom: 10px;">
                        <h4>${driver.name}</h4>
                        <div class="summary-item"><span>Total Trips:</span><span>${driver.trips}</span></div>
                        <div class="summary-item"><span>Completed Trips:</span><span>${driver.completed}</span></div>
                        <div class="summary-item"><span>Completion Rate:</span><span>${completionRate}%</span></div>
                        <div class="summary-item"><span>Total Revenue:</span><span>$${driver.revenue.toFixed(2)}</span></div>
                    </div>
                `;
            }
            
            return reportContent;
        }
        
        // Generate revenue report
        function generateRevenueReport(trips) {
            const completedTrips = trips.filter(t => t.status === 'completed');
            const totalRevenue = completedTrips.reduce((sum, t) => sum + t.fare, 0);
            const avgFare = completedTrips.length > 0 ? totalRevenue / completedTrips.length : 0;
            
            // Group by payment method
            const paymentMethods = {};
            completedTrips.forEach(trip => {
                if (!paymentMethods[trip.payment]) {
                    paymentMethods[trip.payment] = { count: 0, revenue: 0 };
                }
                paymentMethods[trip.payment].count++;
                paymentMethods[trip.payment].revenue += trip.fare;
            });
            
            let reportContent = `
                <h3>Revenue Analysis Report</h3>
                <div style="margin: 20px 0;">
                    <div class="summary-item"><span>Total Completed Trips:</span><span>${completedTrips.length}</span></div>
                    <div class="summary-item"><span>Total Revenue:</span><span>$${totalRevenue.toFixed(2)}</span></div>
                    <div class="summary-item"><span>Average Fare:</span><span>$${avgFare.toFixed(2)}</span></div>
                </div>
                <h4>Revenue by Payment Method</h4>
            `;
            
            for (const method in paymentMethods) {
                const data = paymentMethods[method];
                const percentage = totalRevenue > 0 ? (data.revenue / totalRevenue * 100).toFixed(1) : 0;
                
                reportContent += `
                    <div style="padding: 10px; border-bottom: 1px solid #eee;">
                        <strong>${method.toUpperCase()}:</strong> ${data.count} trips, $${data.revenue.toFixed(2)} (${percentage}%)
                    </div>
                `;
            }
            
            return reportContent;
        }
        
        // Export report to LibreOffice (CSV format)
        function exportReport() {
            const reportType = document.getElementById('reportType').value;
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            
            // Create CSV content based on report type
            let csvContent = '';
            let filename = '';
            
            if (reportType === 'daily') {
                const today = new Date().toISOString().split('T')[0];
                const todayTrips = trips.filter(t => {
                    const tripDate = new Date(t.startTime || t.requestedTime).toISOString().split('T')[0];
                    return tripDate === today;
                });
                
                csvContent = 'Trip ID,Customer,Driver,Pickup,Destination,Fare,Status,Payment\n';
                todayTrips.forEach(trip => {
                    csvContent += `"${trip.id}","${trip.customerName}","${trip.driverName || 'Not assigned'}","${trip.pickup}","${trip.dropoff}",${trip.fare},"${trip.status}","${trip.payment}"\n`;
                });
                
                filename = `daily_report_${today}.csv`;
            } else if (reportType === 'driver') {
                csvContent = 'Driver ID,Driver Name,Trips Today,Total Trips,Rating,Status,Vehicle\n';
                drivers.forEach(driver => {
                    csvContent += `"${driver.id}","${driver.name}",${driver.tripsToday},${driver.totalTrips},${driver.rating},"${driver.status}","${driver.vehicle}"\n`;
                });
                
                filename = `driver_report_${new Date().toISOString().split('T')[0]}.csv`;
            } else {
                // Generic trip export
                csvContent = 'Trip ID,Customer,Driver,Pickup,Destination,Fare,Status,Start Time,End Time\n';
                trips.forEach(trip => {
                    csvContent += `"${trip.id}","${trip.customerName}","${trip.driverName || 'Not assigned'}","${trip.pickup}","${trip.dropoff}",${trip.fare},"${trip.status}","${formatTime(trip.startTime || trip.requestedTime)}","${trip.endTime ? formatTime(trip.endTime) : ''}"\n`;
                });
                
                filename = `trips_export_${new Date().toISOString().split('T')[0]}.csv`;
            }
            
            // Download CSV file
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showAlert(`Report exported as ${filename}`, 'success');
        }
        
        // Export trips to CSV
        function exportTrips() {
            let csvContent = 'Trip ID,Customer Name,Customer Phone,Driver,Pickup Location,Drop-off Location,Fare,Status,Start Time,End Time,Payment Method,Vehicle Type,Notes\n';
            
            trips.forEach(trip => {
                csvContent += `"${trip.id}","${trip.customerName}","${trip.customerPhone}","${trip.driverName || ''}","${trip.pickup}","${trip.dropoff}",${trip.fare},"${trip.status}","${formatTime(trip.startTime || trip.requestedTime)}","${trip.endTime ? formatTime(trip.endTime) : ''}","${trip.payment || ''}","${trip.vehicleType || ''}","${trip.notes || ''}"\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `trips_export_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showAlert('Trips exported to CSV file', 'success');
        }
        
        // Export driver data
        function exportDriverData() {
            let csvContent = 'Driver ID,Name,Phone,License,Vehicle,Color,Plate,Status,Location,Rating,Trips Today,Total Trips\n';
            
            drivers.forEach(driver => {
                csvContent += `"${driver.id}","${driver.name}","${driver.phone}","${driver.license || ''}","${driver.vehicle}","${driver.color}","${driver.plate}","${driver.status}","${driver.location}",${driver.rating},${driver.tripsToday},${driver.totalTrips}\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `drivers_export_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showAlert('Driver data exported to CSV file', 'success');
        }
        
        // Clear completed trips
        function clearCompletedTrips() {
            if (confirm('Are you sure you want to clear all completed trips? This cannot be undone.')) {
                trips = trips.filter(trip => trip.status !== 'completed');
                saveTrips();
                updateAllTripsTable();
                updateDashboard();
                showAlert('Completed trips cleared successfully', 'success');
            }
        }
        
        // View trip details
        function viewTripDetails(tripId) {
            const trip = trips.find(t => t.id === tripId);
            if (!trip) return;
            
            const modalContent = document.getElementById('tripDetailsContent');
            
            let driverInfo = 'Not assigned';
            if (trip.driverId) {
                const driver = drivers.find(d => d.id === trip.driverId);
                if (driver) {
                    driverInfo = `${driver.name} (${driver.vehicle}, ${driver.phone})`;
                }
            }
            
            modalContent.innerHTML = `
                <h3>Trip ${tripId}</h3>
                <div style="margin: 20px 0;">
                    <div class="summary-item"><span>Customer:</span><span>${trip.customerName}</span></div>
                    <div class="summary-item"><span>Phone:</span><span>${trip.customerPhone}</span></div>
                    <div class="summary-item"><span>Pickup:</span><span>${trip.pickup}</span></div>
                    <div class="summary-item"><span>Destination:</span><span>${trip.dropoff}</span></div>
                    <div class="summary-item"><span>Driver:</span><span>${driverInfo}</span></div>
                    <div class="summary-item"><span>Fare:</span><span>$${trip.fare.toFixed(2)}</span></div>
                    <div class="summary-item"><span>Status:</span><span class="status ${getStatusClass(trip.status)}">${trip.status.toUpperCase()}</span></div>
                    <div class="summary-item"><span>Payment:</span><span>${trip.payment || 'Not specified'}</span></div>
                    <div class="summary-item"><span>Requested Time:</span><span>${formatTime(trip.requestedTime)}</span></div>
                    ${trip.startTime ? `<div class="summary-item"><span>Start Time:</span><span>${formatTime(trip.startTime)}</span></div>` : ''}
                    ${trip.endTime ? `<div class="summary-item"><span>End Time:</span><span>${formatTime(trip.endTime)}</span></div>` : ''}
                    ${trip.notes ? `<div class="summary-item"><span>Notes:</span><span>${trip.notes}</span></div>` : ''}
                </div>
                <div class="button-group">
                    ${trip.status === 'pending' ? `<button class="btn btn-success" onclick="assignDriverToTrip('${tripId}'); closeTripDetailsModal()">Assign Driver</button>` : ''}
                    ${trip.status === 'ongoing' ? `<button class="btn btn-primary" onclick="completeTrip('${tripId}'); closeTripDetailsModal()">Complete Trip</button>` : ''}
                    ${trip.status !== 'completed' && trip.status !== 'cancelled' ? `<button class="btn btn-danger" onclick="cancelTrip('${tripId}'); closeTripDetailsModal()">Cancel Trip</button>` : ''}
                    <button class="btn btn-warning" onclick="closeTripDetailsModal()">Close</button>
                </div>
            `;
            
            document.getElementById('tripDetailsModal').style.display = 'flex';
        }
        
        // Complete a trip
        function completeTrip(tripId) {
            const trip = trips.find(t => t.id === tripId);
            if (!trip || trip.status !== 'ongoing') return;
            
            trip.status = 'completed';
            trip.endTime = new Date().toISOString();
            
            // Free up the driver
            if (trip.driverId) {
                const driver = drivers.find(d => d.id === trip.driverId);
                if (driver) {
                    driver.status = 'available';
                    driver.tripsToday++;
                    driver.totalTrips++;
                }
            }
            
            saveTrips();
            saveDrivers();
            updateDashboard();
            updateAllTripsTable();
            
            showAlert(`Trip ${tripId} marked as completed`, 'success');
        }
        
        // Cancel a trip
        function cancelTrip(tripId) {
            if (!confirm('Are you sure you want to cancel this trip?')) return;
            
            const trip = trips.find(t => t.id === tripId);
            if (!trip || trip.status === 'completed' || trip.status === 'cancelled') return;
            
            trip.status = 'cancelled';
            
            // Free up the driver if assigned
            if (trip.driverId) {
                const driver = drivers.find(d => d.id === trip.driverId);
                if (driver) {
                    driver.status = 'available';
                }
            }
            
            saveTrips();
            saveDrivers();
            updateDashboard();
            updateAllTripsTable();
            updatePendingTrips();
            
            showAlert(`Trip ${tripId} cancelled`, 'success');
        }
        
        // View driver details
        function viewDriverDetails(driverId) {
            const driver = drivers.find(d => d.id === driverId);
            if (!driver) return;
            
            // In a real app, this would open a modal with driver details
            alert(`Driver Details:\n\nName: ${driver.name}\nPhone: ${driver.phone}\nVehicle: ${driver.vehicle}\nPlate: ${driver.plate}\nStatus: ${driver.status}\nLocation: ${driver.location}\nRating: ${driver.rating}★\nTrips Today: ${driver.tripsToday}\nTotal Trips: ${driver.totalTrips}`);
        }
        
        // Toggle driver status
        function toggleDriverStatus(driverId) {
            const driver = drivers.find(d => d.id === driverId);
            if (!driver) return;
            
            if (driver.status === 'available') {
                driver.status = 'busy';
                showAlert(`${driver.name} marked as busy`, 'success');
            } else if (driver.status === 'busy') {
                driver.status = 'available';
                showAlert(`${driver.name} marked as available`, 'success');
            } else {
                driver.status = 'available';
                showAlert(`${driver.name} is now available`, 'success');
            }
            
            saveDrivers();
            updateDriverManagement();
            updateAvailableDriversList();
        }
        
        // Open add driver modal
        function openAddDriverModal() {
            document.getElementById('addDriverModal').style.display = 'flex';
        }
        
        // Close add driver modal
        function closeAddDriverModal() {
            document.getElementById('addDriverModal').style.display = 'none';
        }
        
        // Add new driver
        function addNewDriver(event) {
            event.preventDefault();
            
            const name = document.getElementById('newDriverName').value;
            const phone = document.getElementById('newDriverPhone').value;
            const license = document.getElementById('newDriverLicense').value;
            const vehicle = document.getElementById('newDriverVehicle').value;
            const color = document.getElementById('newDriverColor').value;
            const plate = document.getElementById('newDriverPlate').value;
            
            // Create new driver
            const driver = {
                id: 'DRV-' + (drivers.length + 1001).toString(),
                name,
                phone,
                license,
                vehicle,
                color,
                plate,
                status: 'available',
                location: 'Not specified',
                rating: 4.5,
                tripsToday: 0,
                totalTrips: 0
            };
            
            drivers.push(driver);
            saveDrivers();
            updateDriverManagement();
            
            showAlert(`Driver ${name} added successfully`, 'success');
            closeAddDriverModal();
            event.target.reset();
        }
        
        // Close trip details modal
        function closeTripDetailsModal() {
            document.getElementById('tripDetailsModal').style.display = 'none';
        }
        
        // Filter drivers
        function filterDrivers(filter) {
            // Update active filter button
            document.querySelectorAll('.filter-buttons .filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // In a real app, this would filter the drivers list
            showAlert(`Filtering drivers by: ${filter}`, 'success');
        }
        
        // Filter trips
        function filterTrips(filter) {
            // Update active filter button
            document.querySelectorAll('.filter-buttons .filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // In a real app, this would filter the trips table
            showAlert(`Filtering trips by: ${filter}`, 'success');
        }
        
        // Search drivers
        function searchDrivers() {
            const searchTerm = document.getElementById('driverSearch').value.toLowerCase();
            // In a real app, this would filter the drivers list
            console.log('Searching drivers for:', searchTerm);
        }
        
        // Search trips
        function searchTrips() {
            const searchTerm = document.getElementById('tripSearch').value.toLowerCase();
            // In a real app, this would filter the trips table
            console.log('Searching trips for:', searchTerm);
        }
        
        // Refresh driver status
        function refreshDriverStatus() {
            // Simulate status updates
            drivers.forEach(driver => {
                if (driver.status === 'available' && Math.random() > 0.7) {
                    driver.status = 'busy';
                } else if (driver.status === 'busy' && Math.random() > 0.8) {
                    driver.status = 'available';
                    driver.tripsToday++;
                }
                
                // Update location
                const locations = ['Downtown', 'Airport', 'North District', 'West End', 'City Center', 'East Side'];
                if (Math.random() > 0.5) {
                    driver.location = locations[Math.floor(Math.random() * locations.length)];
                }
            });
            
            saveDrivers();
            updateDriverManagement();
            updateAvailableDriversList();
            
            showAlert('Driver status refreshed', 'success');
        }
        
        // Simulate real-time updates
        function simulateRealTimeUpdates() {
            // Randomly update some driver statuses
            if (Math.random() > 0.5) {
                const availableDrivers = drivers.filter(d => d.status === 'available');
                if (availableDrivers.length > 0 && Math.random() > 0.7) {
                    const driver = availableDrivers[Math.floor(Math.random() * availableDrivers.length)];
                    driver.status = 'busy';
                    
                    // Create a fake trip for this driver
                    const customerNames = ['Alex Johnson', 'Sam Wilson', 'Taylor Swift', 'Jamie Lee', 'Casey Smith'];
                    const locations = ['123 Main St', '456 Oak Ave', '789 Pine Rd', '321 Elm St', '654 Maple Dr'];
                    
                    const trip = {
                        id: 'TRIP-' + Date.now().toString().slice(-6),
                        customerName: customerNames[Math.floor(Math.random() * customerNames.length)],
                        customerPhone: '(555) ' + (100 + Math.floor(Math.random() * 900)) + '-' + (1000 + Math.floor(Math.random() * 9000)),
                        pickup: locations[Math.floor(Math.random() * locations.length)],
                        dropoff: locations[Math.floor(Math.random() * locations.length)],
                        driverId: driver.id,
                        driverName: driver.name,
                        status: 'ongoing',
                        fare: 15 + Math.floor(Math.random() * 40),
                        payment: ['cash', 'card', 'mobile'][Math.floor(Math.random() * 3)],
                        startTime: new Date().toISOString(),
                        estimatedDuration: 15 + Math.floor(Math.random() * 30)
                    };
                    
                    trips.push(trip);
                    saveTrips();
                }
            }
            
            // Randomly complete some ongoing trips
            const ongoingTrips = trips.filter(t => t.status === 'ongoing');
            if (ongoingTrips.length > 0 && Math.random() > 0.8) {
                const trip = ongoingTrips[Math.floor(Math.random() * ongoingTrips.length)];
                trip.status = 'completed';
                trip.endTime = new Date().toISOString();
                
                // Free up the driver
                const driver = drivers.find(d => d.id === trip.driverId);
                if (driver) {
                    driver.status = 'available';
                    driver.tripsToday++;
                    driver.totalTrips++;
                }
                
                saveTrips();
                saveDrivers();
            }
            
            // Update dashboard if we're on it
            if (currentTab === 'dashboard') {
                updateDashboard();
            }
            
            // Update driver management if we're on it
            if (currentTab === 'drivers') {
                updateDriverManagement();
            }
        }
        
        // Show alert message
        function showAlert(message, type) {
            const alertDiv = document.getElementById(`${type === 'success' ? 'dispatchSuccessAlert' : 'dispatchErrorAlert'}`);
            alertDiv.textContent = message;
            alertDiv.style.display = 'block';
            
            // Hide after 5 seconds
            setTimeout(() => {
                alertDiv.style.display = 'none';
            }, 5000);
        }
        
        // Helper function to get status class
        function getStatusClass(status) {
            switch(status) {
                case 'pending': return 'status-pending';
                case 'assigned': return 'status-assigned';
                case 'ongoing': return 'status-ongoing';
                case 'completed': return 'status-completed';
                case 'cancelled': return 'status-cancelled';
                default: return '';
            }
        }
        
        // Helper function to format time
        function formatTime(dateString) {
            if (!dateString) return '--';
            const date = new Date(dateString);
            return date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }
        
        // Helper function to truncate text
        function truncateText(text, maxLength) {
            if (!text) return '';
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '...';
        }
    </script>
</body>
</html>
